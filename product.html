<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>S·∫£n Ph·∫©m - Tech Store</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .product-card { border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.08); transition: 0.3s; height: 100%; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 6px 15px rgba(0,0,0,0.15); }
        .product-img { height: 200px; object-fit: cover; background: #f8f9fa; cursor: pointer; }
        .product-title-link { text-decoration: none; color: #212529; }
        .product-title-link:hover { color: #0d6efd; }
    </style>
</head>
<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
    <div class="container">
        <a class="navbar-brand fw-bold" href="product.html">TECH STORE</a>
        <button class="btn btn-warning position-relative" data-bs-toggle="modal" data-bs-target="#cartModal">
            üõí Gi·ªè h√†ng
            <span id="cart-count" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">0</span>
        </button>
    </div>
</nav>

<div class="container mt-5">
    <h3 class="mb-4 fw-bold">Danh s√°ch s·∫£n ph·∫©m</h3>
    <div class="row" id="product-display">
        </div>
</div>

<div class="modal fade" id="cartModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Gi·ªè h√†ng c·ªßa b·∫°n</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <table class="table align-middle">
                    <thead>
                        <tr><th>T√™n</th><th>Gi√°</th><th>SL</th><th>T·ªïng</th></tr>
                    </thead>
                    <tbody id="cart-table-body"></tbody>
                </table>
                <h4 class="text-end text-danger fw-bold">T·ªïng: <span id="cart-total">0</span>ƒë</h4>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-secondary" onclick="clearCart()">X√≥a h·∫øt</button>
                <button class="btn btn-primary px-4">Thanh to√°n</button>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
$(document).ready(function() {
    loadProducts();
    updateCartUI();

    function loadProducts() {
        $.getJSON('api/product.php', function(data) {
            let html = '';
            data.forEach(p => {
                let img = p.image_url ? p.image_url : 'https://via.placeholder.com/200';
                html += `
                <div class="col-md-3 mb-4">
                    <div class="card product-card shadow-sm">
                        <a href="detail.html?id=${p.id}">
                            <img src="${img}" class="card-img-top product-img" alt="${p.product_name}">
                        </a>
                        <div class="card-body d-flex flex-column">
                            <span class="badge bg-info text-dark mb-2 w-fit-content">${p.category_name || 'Kh√°c'}</span>
                            <a href="detail.html?id=${p.id}" class="product-title-link">
                                <h6 class="card-title fw-bold">${p.product_name}</h6>
                            </a>
                            <p class="text-danger fw-bold mt-auto fs-5">${Number(p.price).toLocaleString()}ƒë</p>
                            <button class="btn btn-dark btn-sm add-btn mt-2" 
                                data-id="${p.id}" data-name="${p.product_name}" data-price="${p.price}">
                                Th√™m v√†o gi·ªè
                            </button>
                        </div>
                    </div>
                </div>`;
            });
            $('#product-display').html(html);
        }).fail(function() {
            $('#product-display').html('<div class="col-12 text-center"><p class="text-muted">Kh√¥ng th·ªÉ t·∫£i danh s√°ch s·∫£n ph·∫©m. Vui l√≤ng ki·ªÉm tra l·∫°i API.</p></div>');
        });
    }

    $(document).on('click', '.add-btn', function() {
        const item = {
            id: $(this).data('id'),
            name: $(this).data('name'),
            price: $(this).data('price')
        };
        // C·∫ßn s·ª≠a th√†nh api/cart.php v√¨ file n·∫±m trong th∆∞ m·ª•c api
        $.post('api/cart.php?action=add', item, function(res) {
            updateCartUI();
            alert('ƒê√£ th√™m s·∫£n ph·∫©m v√†o gi·ªè!');
        });
    });

    function updateCartUI() {
        $.getJSON('api/cart.php?action=view', function(cart) {
            let html = '';
            let total = 0;
            let count = 0;
            $.each(cart, function(id, item) {
                let subtotal = item.price * item.quantity;
                total += subtotal;
                count++;
                html += `<tr>
                    <td>${item.name}</td>
                    <td>${Number(item.price).toLocaleString()}ƒë</td>
                    <td>${item.quantity}</td>
                    <td class="fw-bold">${Number(subtotal).toLocaleString()}ƒë</td>
                </tr>`;
            });
            $('#cart-table-body').html(html || '<tr><td colspan="4" class="text-center text-muted">Gi·ªè h√†ng tr·ªëng</td></tr>');
            $('#cart-total').text(total.toLocaleString());
            $('#cart-count').text(count);
        });
    }

    window.clearCart = function() {
        if(confirm('X√≥a to√†n b·ªô gi·ªè h√†ng?')) {
            $.get('api/cart.php?action=clear', function() {
                updateCartUI();
            });
        }
    }
});
</script>
</body>
</html>